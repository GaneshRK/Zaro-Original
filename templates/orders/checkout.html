{% extends 'base/base.html' %}
{% block title %}Checkout{% endblock %}

{% block content %}
<div class="section-container">
  <div class="section-inner">

    <h3>Checkout</h3>

    <ul>
      {% for course in courses %}
        <li>{{ course.name }} – ₹{{ course.discount_price }}</li>
      {% endfor %}
    </ul>

    <hr>

    <h4>Total Payable: ₹{{ total_amount }}</h4>

    <button id="rzpayBtn" class="button mt-3">
      Pay with Razorpay
    </button>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
document.getElementById('rzpayBtn').onclick = function () {
    var options = {
        "key": "{{ razorpay_key }}",
        "amount": "{{ order.amount }}",
        "currency": "INR",
        "order_id": "{{ order_obj.razorpay_order_id }}",
        "name": "ZARO",
        "description": "Course Purchase",
        "handler": function (response) {

            fetch("{% url 'orders:payment_success' %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                    "X-CSRFToken": "{{ csrf_token }}"
                },
                body:
                    "razorpay_payment_id=" + response.razorpay_payment_id +
                    "&razorpay_order_id=" + response.razorpay_order_id +
                    "&razorpay_signature=" + response.razorpay_signature
            }).then(() => {
                window.location.href = "/";
            });
        }
    };

    var rzp = new Razorpay(options);
    rzp.open();
};
</script>
{% endblock %}
