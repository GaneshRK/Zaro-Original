{% extends 'base/base.html' %}
{% load static %}
{% block title %}{{ course.name }}{% endblock %}

{% block content %}
<style>
.course-hero {
    margin-top: 120px;
}

.course-card {
    background: rgba(40,45,40,0.9);
    border-radius: 16px;
    padding: 30px;
    border: 1px solid rgba(139,174,102,0.3);
}

.course-thumbnail img,
.course-video video {
    width: 100%;
    max-height: 420px;
    object-fit: cover;
    border-radius: 14px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.35);
}

.course-price {
    font-size: 1.4rem;
    font-weight: 600;
    color: var(--accent2);
}

.learn-list li {
    margin-bottom: 10px;
}

.learn-list i {
    color: var(--accent2);
    margin-right: 8px;
}

.sticky-box {
    position: sticky;
    top: 120px;
}
</style>

<div class="container course-hero">
    <div class="row g-4">

        <!-- LEFT CONTENT -->
        <div class="col-lg-8">

            <div class="course-card mb-4">
                <h1 class="mb-3">{{ course.name }}</h1>
                <p class="opacity-75">{{ course.slogan }}</p>
            </div>

            {% with course.thumbnails.first as first_thumb %}
                {% if first_thumb %}
                    <div class="course-thumbnail mb-4">
                        <img src="{{ first_thumb.image.url }}" alt="{{ course.name }}">
                    </div>
                {% endif %}
            {% endwith %}

            <!-- Full Description -->
            <div class="course-card mb-4">
                <h4 class="mb-3">Course Overview</h4>
                <p>{{ course.description|linebreaks }}</p>
            </div>

            <!-- What They Learn -->
            <div class="course-card mb-4">
                <h4 class="mb-3">What You’ll Learn</h4>
                <ul class="learn-list list-unstyled">
                    {% for point in course.what_they_Learn.splitlines %}
                    <li><i class="bi bi-check-circle-fill"></i> {{ point }}</li>
                    {% endfor %}
                </ul>
            </div>

            <div class="course-card mb-4">
                <h4 class="mb-3">Who This Course Is For</h4>
                <ul class="learn-list list-unstyled">
                    {% for point in course.who_this_is_for.splitlines %}
                    <li><i class="bi bi-check-circle-fill"></i> {{ point }}</li>
                    {% endfor %}
                </ul>
            </div>

        </div>

        <!-- RIGHT SIDEBAR -->
        <div class="col-lg-4">
            <div class="course-card sticky-box" style="margin-bottom: 20px;">
                <h4 class="mb-3">Course Details</h4>
                <form method="post">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label class="form-label">Promo Code</label>
                        <input type="text"
                            name="promo_code"
                            class="form-control"
                            placeholder="Enter promo code"
                            value="{{ applied_code|default:'' }}">
                    </div>

                    <button type="submit" name="apply_promo" class="button w-100 mb-3">
                        Apply Promo Code
                    </button>
                </form>

                {% if final_price != course.original_price %}
                    <p class="course-price mb-1">
                        <del class="opacity-50">₹ {{ course.original_price }}</del>
                    </p>
                    <p class="course-price">
                        ₹ {{ final_price }}
                    </p>
                {% else %}
                    <p class="course-price">
                        ₹ {{ course.original_price }}
                    </p>
                {% endif %}

                {% if promo_error %}
                    <p class="text-danger small mt-2">{{ promo_error }}</p>
                {% endif %}
                {% if user.is_authenticated %}
                    <form method="post" action="{% url 'orders:checkout' %}">
                        {% csrf_token %}
                        <input type="hidden" name="courses" value="{{ course.id }}">
                        {% if applied_code %}
                            <input type="hidden" name="promo_code" value="{{ applied_code }}">
                        {% endif %}
                        <button type="submit" class="button w-100 mb-3">Buy Now</button>
                    </form>
                {% else %}
                    <a href="/accounts/login/?next={{ request.path }}" class="button w-100 mb-3">
                        Login to Buy    
                    </a>
                {% endif %}

                <ul class="list-unstyled mt-3">
                    <li>✔ Lifetime Access</li>
                    <li>✔ Beginner Friendly</li>
                    <li>✔ Mobile & Desktop</li>
                    <li>✔ Certificate Included</li>
                </ul>
            </div>
        </div>

    </div>
</div>
{% endblock %}
