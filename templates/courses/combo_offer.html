{% extends 'base/base.html' %}
{% block title %}Combo Offers{% endblock %}

{% block content %}
<div class="section-container combo-page">
  <div class="section-inner">

    <h2 class="text-center mb-2">ðŸ”¥ Special Combo Offers</h2>
    <p class="text-center opacity-75 mb-5">
      Choose your category and build your perfect learning combo
    </p>

    {% if combo_error %}
      <p class="text-danger text-center">{{ combo_error }}</p>
    {% endif %}

    <!-- CATEGORY SELECT -->
    <div class="text-center mb-5 d-flex justify-content-center gap-3 flex-wrap">
      <button type="button" class="combo-toggle"
              onclick="showCategory('elite')">
        Elite Combo
      </button>
      <button type="button" class="combo-toggle"
              onclick="showCategory('premium')">
        Premium Combo
      </button>
    </div>

    <form method="post">
      {% csrf_token %}

      <!-- ELITE -->
      <div id="elite-section" class="d-none fade-soft">
        <h4 class="mb-4">Elite Courses</h4>
        <div class="row g-4">
          {% for course in elite_courses %}
          <div class="col-md-4">
            <label class="combo-card">
              <input type="checkbox" name="courses" value="{{ course.id }}">
              <div class="combo-course-box">
                <h5>{{ course.name }}</h5>
                <p>{{ course.slogan }}</p>
              </div>
            </label>
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- PREMIUM -->
      <div id="premium-section" class="d-none fade-soft">
        <h4 class="mb-4">Premium Courses</h4>
        <div class="row g-4">
          {% for course in premium_courses %}
          <div class="col-md-4">
            <label class="combo-card">
              <input type="checkbox" name="courses" value="{{ course.id }}">
              <div class="combo-course-box premium">
                <h5>{{ course.name }}</h5>
                <p>{{ course.slogan }}</p>
              </div>
            </label>
          </div>
          {% endfor %}
        </div>
      </div>

      <div class="text-center mt-5">
        <button type="submit" class="button">
          Calculate Combo Price
        </button>
      </div>
    </form>

    {% if final_price %}
    <div class="course-card mt-5 p-4 text-center fade-soft">
      <h4>ðŸŽ‰ Combo Price</h4>
      <p class="course-price fs-3 mt-2">â‚¹ {{ final_price }}</p>

      {% if user.is_authenticated %}
      <form method="post" action="{% url 'orders:checkout' %}">
        {% csrf_token %}
        {% for c in selected_courses %}
          <input type="hidden" name="courses" value="{{ c.id }}">
        {% endfor %}
        <button class="button mt-3">Buy Combo</button>
      </form>
      {% else %}
        <a href="/accounts/login/" class="button mt-3">Login to Buy</a>
      {% endif %}
    </div>
    {% endif %}

  </div>
</div>

<!-- JS -->
<script>
function showCategory(type) {
  document.getElementById('elite-section').classList.add('d-none');
  document.getElementById('premium-section').classList.add('d-none');

  document.getElementById(type + '-section').classList.remove('d-none');

  document.querySelectorAll('input[name="courses"]').forEach(cb => cb.checked = false);
}
</script>

<!-- PAGE-SCOPED STYLES -->
<style>
.combo-page {
  margin-top: 15vh;     /* space below navbar */
  margin-bottom: 80px;  /* space above footer */
}

/* CATEGORY BUTTONS */
.combo-toggle {
  padding: 10px 28px;
  border-radius: 999px;
  border: 2px solid var(--accent2);
  background: transparent;
  color: var(--light);
  font-weight: 600;
  transition: all 0.3s ease;
}
.combo-toggle:hover {
  background: var(--accent);
  transform: translateY(-2px);
}

/* COURSE CARD */
.combo-card input {
  display: none;
}

.combo-course-box {
  background-color: var(--bg);
  border: 3px solid rgba(139,174,102,0.4);
  border-radius: 14px;
  padding: 24px;
  height: 100%;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0px 5px 15px rgba(139,174,102,0.15);
}

.combo-course-box h5 {
  color: var(--light);
}
.combo-course-box p {
  font-size: 0.9rem;
  opacity: 0.8;
}

.combo-course-box:hover {
  transform: translateY(-6px);
  box-shadow: 0px 12px 25px rgba(139,174,102,0.25);
}

/* SELECTED */
.combo-card input:checked + .combo-course-box {
  border-color: var(--accent2);
  background: rgba(139,174,102,0.08);
}

/* PREMIUM SLIGHT VARIATION */
.combo-course-box.premium {
  border-style: dashed;
}

/* SOFT FADE */
.fade-soft {
  animation: fadeSoft 0.4s ease;
}
@keyframes fadeSoft {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

{% endblock %}
